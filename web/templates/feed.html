{{ define "feed-content" }}
<div class="feed-page">
    <div class="container">
        <!-- Feed Header -->
        <header class="feed-header">
            <h1 class="sr-only">{{ .config.Blog.Title }} — Feed</h1>
            {{ if .config.Blog.Tagline }}
            <p class="feed-tagline">{{ .config.Blog.Tagline }}</p>
            {{ else if .config.Blog.Description }}
            <p class="feed-tagline">{{ .config.Blog.Description }}</p>
            {{ end }}
        </header>

        <!-- Feed Type Filters -->
        <nav class="feed-filters" aria-label="Filter by type">
            <a href="/" class="feed-filter{{ if eq .activeFilter "" }} active{{ end }}">All</a>
            <a href="/?type=thought" class="feed-filter{{ if eq .activeFilter "thought" }} active{{ end }}">Thoughts</a>
            <a href="/?type=link" class="feed-filter{{ if eq .activeFilter "link" }} active{{ end }}">Links</a>
            <a href="/?type=article" class="feed-filter{{ if eq .activeFilter "article" }} active{{ end }}">Articles</a>
        </nav>

        <!-- Feed Stream -->
        <section class="content-stream" aria-label="Posts">
            {{ if .posts }}
                {{ range .posts }}
                    {{ template "card-by-type" . }}
                {{ end }}
            {{ else }}
            <div class="empty-state">
                <h2>No posts yet</h2>
                <p>This is a fresh start. Write your first thought, share a link, or publish an article.</p>
                {{ if .authenticated }}
                <a href="/compose" class="empty-state-cta">Create your first post</a>
                {{ end }}
            </div>
            {{ end }}
        </section>

        <!-- Pagination -->
        {{ if .pagination }}
        {{ $p := .pagination }}
        {{ $f := .activeFilter }}
        {{ if or $p.HasPrevious $p.HasNext }}
        <nav class="simple-pagination" aria-label="Feed pagination">
            {{ if $p.HasPrevious }}
            <a href="/?page={{ $p.PreviousPage }}{{ if $f }}&type={{ $f | urlquery }}{{ end }}" class="simple-pagination-link">← Newer</a>
            {{ end }}
            <span class="pagination-info">Page {{ $p.CurrentPage }} of {{ $p.TotalPages }}</span>
            {{ if $p.HasNext }}
            <a href="/?page={{ $p.NextPage }}{{ if $f }}&type={{ $f | urlquery }}{{ end }}" class="simple-pagination-link">Older →</a>
            {{ end }}
        </nav>
        {{ end }}
        {{ end }}
    </div>
</div>
{{ end }}

{{ define "card-thought" }}
<article class="feed-card feed-card-thought">
    <div class="feed-card-accent"></div>
    <div class="feed-card-body">
        <div class="feed-card-content thought-content">
            {{ if .ProcessedContent }}
                {{ .ProcessedContent | safeHTML }}
            {{ else }}
                {{ .Content | safeHTML }}
            {{ end }}
        </div>
        <div class="feed-card-meta">
            <a href="/writing/{{ .Slug }}" class="feed-card-permalink">
                <time class="feed-card-time" datetime="{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}">
                    {{ relativeTime .Date }}
                </time>
            </a>
            {{ if .Tags }}
            <div class="feed-card-tags">
                {{ range .Tags }}
                <a href="/tags/{{ . | urlquery }}" class="feed-tag">{{ . }}</a>
                {{ end }}
            </div>
            {{ end }}
        </div>
    </div>
</article>
{{ end }}

{{ define "card-link" }}
<article class="feed-card feed-card-link">
    <div class="feed-card-body">
        <h2 class="feed-card-title">
            <a href="/writing/{{ .Slug }}">{{ .Title }}</a>
        </h2>
        {{ if .LinkURL }}
        <a href="{{ .LinkURL }}" class="feed-card-link-url" target="_blank" rel="noopener">
            <span class="feed-card-domain">{{ extractDomain .LinkURL }}</span>
            <span class="feed-card-external-icon">→</span>
        </a>
        {{ end }}
        {{ if .Excerpt }}
        <p class="feed-card-excerpt">{{ .Excerpt }}</p>
        {{ end }}
        <div class="feed-card-meta">
            <time class="feed-card-time" datetime="{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}">
                {{ relativeTime .Date }}
            </time>
            {{ if .Tags }}
            <div class="feed-card-tags">
                {{ range .Tags }}
                <a href="/tags/{{ . | urlquery }}" class="feed-tag">{{ . }}</a>
                {{ end }}
            </div>
            {{ end }}
        </div>
    </div>
</article>
{{ end }}

{{ define "card-article" }}
<article class="feed-card feed-card-article">
    <div class="feed-card-body">
        <h2 class="feed-card-title">
            <a href="/writing/{{ .Slug }}">{{ .Title }}</a>
        </h2>
        {{ if .Description }}
        <p class="feed-card-description">{{ .Description }}</p>
        {{ else if .Excerpt }}
        <p class="feed-card-excerpt">{{ .Excerpt }}</p>
        {{ end }}
        <div class="feed-card-meta">
            <time class="feed-card-time" datetime="{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}">
                {{ .Date.Format "Jan 2, 2006" }}
            </time>
            <span class="feed-card-reading-time">{{ .ReadingTime }} min read</span>
            {{ if .Tags }}
            <div class="feed-card-tags">
                {{ range .Tags }}
                <a href="/tags/{{ . | urlquery }}" class="feed-tag">{{ . }}</a>
                {{ end }}
            </div>
            {{ end }}
        </div>
    </div>
</article>
{{ end }}

{{ define "card-by-type" }}
{{ if eq .Type "thought" }}
    {{ template "card-thought" . }}
{{ else if eq .Type "link" }}
    {{ template "card-link" . }}
{{ else }}
    {{ template "card-article" . }}
{{ end }}
{{ end }}

{{ define "feed-head" }}
<meta name="description" content="{{ .config.Blog.Description }}">
<meta name="keywords" content="blog, technology, programming, development, {{ .config.Blog.Author }}">
{{ end }}
