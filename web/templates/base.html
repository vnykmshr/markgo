<!DOCTYPE html>
<html lang="{{ .config.Blog.Language | default "en" }}" data-color-theme="{{ .config.Blog.Theme | default "default" }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <script>try{var t=localStorage.getItem("theme");if(t==="dark"||t==="light")document.documentElement.setAttribute("data-theme",t)}catch(e){}</script>

    <!-- Primary Meta Tags -->
    <title>{{ if .title }}{{ .title }}{{ else }}{{ .config.Blog.Title }}{{ end }}</title>

    {{ if not .config.SEO.Enabled }}
    {{/* Static meta tags when SEO service is disabled */}}
    <meta name="title" content="{{ if .title }}{{ .title }}{{ else }}{{ .config.Blog.Title }}{{ end }}">
    <meta name="description" content="{{ if .description }}{{ .description }}{{ else }}{{ .config.Blog.Description }}{{ end }}">
    <meta name="author" content="{{ .config.Blog.Author }}">
    <meta name="robots" content="index, follow">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="{{ if .article }}article{{ else }}website{{ end }}">
    <meta property="og:url" content="{{ .config.BaseURL }}{{ if .article }}/articles/{{ .article.Slug }}{{ end }}">
    <meta property="og:title" content="{{ if .title }}{{ .title }}{{ else }}{{ .config.Blog.Title }}{{ end }}">
    <meta property="og:description" content="{{ if .description }}{{ .description }}{{ else if .article }}{{ .article.Excerpt }}{{ else }}{{ .config.Blog.Description }}{{ end }}">
    <meta property="og:site_name" content="{{ .config.Blog.Title }}">
    <meta property="og:locale" content="{{ .config.Blog.Language | default "en_US" }}">
    {{ if .article }}
    <meta property="og:image" content="{{ .config.BaseURL }}/static/img/og-article-default.png">
    <meta property="og:image:alt" content="{{ .article.Title }} - {{ .config.Blog.Title }}">
    {{ else }}
    <meta property="og:image" content="{{ .config.BaseURL }}/static/img/og-default.png">
    <meta property="og:image:alt" content="{{ .config.Blog.Title }} - {{ .config.Blog.Description }}">
    {{ end }}
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:image:type" content="image/png">

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="{{ .config.BaseURL }}{{ if .article }}/articles/{{ .article.Slug }}{{ end }}">
    <meta name="twitter:title" content="{{ if .title }}{{ .title }}{{ else }}{{ .config.Blog.Title }}{{ end }}">
    <meta name="twitter:description" content="{{ if .description }}{{ .description }}{{ else if .article }}{{ .article.Excerpt }}{{ else }}{{ .config.Blog.Description }}{{ end }}">
    {{ if .article }}
    <meta name="twitter:image" content="{{ .config.BaseURL }}/static/img/og-article-default.png">
    <meta name="twitter:image:alt" content="{{ .article.Title }} - {{ .config.Blog.Title }}">
    {{ else }}
    <meta name="twitter:image" content="{{ .config.BaseURL }}/static/img/og-default.png">
    <meta name="twitter:image:alt" content="{{ .config.Blog.Title }} - {{ .config.Blog.Description }}">
    {{ end }}
    {{/* Twitter social meta tags disabled - Social config not implemented yet
    {{ if .config.Social.TwitterHandle }}
    <meta name="twitter:site" content="@{{ .config.Social.TwitterHandle }}">
    <meta name="twitter:creator" content="@{{ .config.Social.TwitterHandle }}">
    {{ end }}
    */}}

    <!-- Article specific meta -->
    {{ if .article }}
    <meta property="article:author" content="{{ .config.Blog.Author }}">
    <meta property="article:published_time" content="{{ .article.Date.Format "2006-01-02T15:04:05Z07:00" }}">
    {{ if .article.LastModified }}
    <meta property="article:modified_time" content="{{ .article.LastModified.Format "2006-01-02T15:04:05Z07:00" }}">
    {{ end }}
    <meta property="article:section" content="{{ if .article.Categories }}{{ index .article.Categories 0 }}{{ else }}Blog{{ end }}">
    {{ range .article.Tags }}
    <meta property="article:tag" content="{{ . }}">
    {{ end }}
    {{ range .article.Categories }}
    <meta property="article:section" content="{{ . }}">
    {{ end }}
    {{ if .article.ReadingTime }}
    <meta name="twitter:label1" content="Reading time">
    <meta name="twitter:data1" content="{{ .article.ReadingTime }} min read">
    {{ end }}
    {{ if .article.WordCount }}
    <meta name="twitter:label2" content="Word count">
    <meta name="twitter:data2" content="{{ .article.WordCount }} words">
    {{ end }}
    {{ end }}

    <!-- Additional SEO meta -->
    <meta name="theme-color" content="#1a1a1a">
    <meta name="msapplication-navbutton-color" content="#1a1a1a">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    {{ end }}

    <!-- Enhanced SEO Service Integration -->
    {{ if .config.SEO.Enabled }}
        {{/* Enhanced meta tags from SEO service */}}
        {{ if .seoMetaTags }}{{ renderMetaTags .seoMetaTags }}{{ end }}

        {{/* JSON-LD Structured Data */}}
        {{ if .articleSchema }}{{ generateJsonLD .articleSchema }}{{ end }}
        {{ if .websiteSchema }}{{ generateJsonLD .websiteSchema }}{{ end }}
        {{ if .breadcrumbSchema }}{{ generateJsonLD .breadcrumbSchema }}{{ end }}

        {{/* SEO Verification Tags */}}
        {{ if .config.SEO.GoogleSiteVerify }}
        <meta name="google-site-verification" content="{{ .config.SEO.GoogleSiteVerify }}">
        {{ end }}
        {{ if .config.SEO.BingSiteVerify }}
        <meta name="msvalidate.01" content="{{ .config.SEO.BingSiteVerify }}">
        {{ end }}
        {{ if .config.SEO.FacebookAppID }}
        <meta property="fb:app_id" content="{{ .config.SEO.FacebookAppID }}">
        {{ end }}
    {{ else }}
        {{/* Fallback Schema.org structured data */}}
        {{ if .article }}
        <meta itemprop="name" content="{{ .article.Title }}">
        <meta itemprop="description" content="{{ if .article.Description }}{{ .article.Description }}{{ else }}{{ seoExcerpt .article.Content 160 }}{{ end }}">
        <meta itemprop="image" content="{{ .config.BaseURL }}/static/img/og-article-default.png">
        <meta itemprop="author" content="{{ .config.Blog.Author }}">
        <meta itemprop="datePublished" content="{{ .article.Date.Format "2006-01-02T15:04:05Z07:00" }}">
        {{ if .article.LastModified }}
        <meta itemprop="dateModified" content="{{ .article.LastModified.Format "2006-01-02T15:04:05Z07:00" }}">
        {{ end }}
        {{ end }}
    {{ end }}

    <!-- Favicon -->
    <link rel="apple-touch-icon-precomposed" sizes="57x57" href="/static/img/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/static/img/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/static/img/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/static/img/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon-precomposed" sizes="60x60" href="/static/img/apple-touch-icon-60x60.png" />
    <link rel="apple-touch-icon-precomposed" sizes="120x120" href="/static/img/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon-precomposed" sizes="76x76" href="/static/img/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="/static/img/apple-touch-icon-152x152.png" />

    <link rel="icon" type="image/png" href="/static/img/favicon-196x196.png" sizes="196x196" />
    <link rel="icon" type="image/png" href="/static/img/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/png" href="/static/img/favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="/static/img/favicon-16x16.png" sizes="16x16" />
    <link rel="icon" type="image/png" href="/static/img/favicon-128.png" sizes="128x128" />

    <meta name="application-name" content="&nbsp;"/>
    <meta name="msapplication-TileColor" content="#FFFFFF" />
    <meta name="msapplication-TileImage" content="/static/img/mstile-144x144.png" />
    <meta name="msapplication-square70x70logo" content="/static/img/mstile-70x70.png" />
    <meta name="msapplication-square150x150logo" content="/static/img/mstile-150x150.png" />
    <meta name="msapplication-wide310x150logo" content="/static/img/mstile-310x150.png" />
    <meta name="msapplication-square310x310logo" content="/static/img/mstile-310x310.png" />

    <link rel="manifest" href="/static/site.webmanifest">

    <!-- Feeds -->
    <link rel="alternate" type="application/rss+xml" title="{{ .config.Blog.Title }} - RSS Feed" href="/feed.xml">
    <link rel="alternate" type="application/feed+json" title="{{ .config.Blog.Title }} - JSON Feed" href="/feed.json">

    <!-- Canonical URL -->
    <link rel="canonical" href="{{ .config.BaseURL }}{{ if .article }}/articles/{{ .article.Slug }}{{ end }}">

    <!-- Preconnect to external resources -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <!-- Stylesheets -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <link rel="stylesheet" href="/static/css/main.css">
    {{ if .config.Blog.Style }}<link rel="stylesheet" href="/static/css/themes/{{ .config.Blog.Style }}.css">{{ end }}

    <!-- Shared card CSS (pages that use feed card partials) -->
    {{ $tpl := .template }}
    {{ if or (eq $tpl "feed") (eq $tpl "article") (eq $tpl "articles") (eq $tpl "search") (eq $tpl "tag") (eq $tpl "category") }}<link rel="stylesheet" href="/static/css/cards.css">{{ end }}

    <!-- Template-specific CSS -->
    {{ if eq $tpl "404" }}<link rel="stylesheet" href="/static/css/404.css">{{ end }}
    {{ if eq $tpl "article" }}<link rel="stylesheet" href="/static/css/article.css">{{ end }}
    {{ if eq $tpl "articles" }}<link rel="stylesheet" href="/static/css/articles.css">{{ end }}
    {{ if eq $tpl "about-article" }}<link rel="stylesheet" href="/static/css/about-article.css">{{ end }}
    {{ if eq $tpl "contact" }}<link rel="stylesheet" href="/static/css/contact.css">{{ end }}
    {{ if eq $tpl "search" }}<link rel="stylesheet" href="/static/css/search.css">{{ end }}
    {{ if eq $tpl "tags" }}<link rel="stylesheet" href="/static/css/tags.css">{{ end }}
    {{ if eq $tpl "categories" }}<link rel="stylesheet" href="/static/css/categories.css">{{ end }}
    {{ if eq $tpl "feed" }}<link rel="stylesheet" href="/static/css/feed.css">{{ end }}
    {{ if eq $tpl "compose" }}<link rel="stylesheet" href="/static/css/compose.css">{{ end }}
    {{ if eq $tpl "admin_home" }}<link rel="stylesheet" href="/static/css/admin.css">{{ end }}

    <!-- Additional head content -->
    {{ if eq $tpl "feed" }}{{ template "feed-head" . }}{{ end }}
    {{ if eq $tpl "compose" }}{{ template "compose-head" . }}{{ end }}
    {{ if eq $tpl "articles" }}{{ template "articles-head" . }}{{ end }}
    {{ if eq $tpl "article" }}{{ template "article-head" . }}{{ end }}
    {{ if eq $tpl "search" }}{{ template "search-head" . }}{{ end }}
    {{ if eq $tpl "contact" }}{{ template "contact-head" . }}{{ end }}

    {{ if eq $tpl "about-article" }}{{ template "about-article-head" . }}{{ end }}
    {{ if eq $tpl "tags" }}{{ template "tags-head" . }}{{ end }}
    {{ if eq $tpl "categories" }}{{ template "categories-head" . }}{{ end }}
    {{ if eq $tpl "admin_home" }}{{ template "admin_home-head" . }}{{ end }}
    {{ if eq $tpl "404" }}{{ template "404-head" . }}{{ end }}
</head>
<body class="{{- $tpl := .template | default "feed" -}}
    {{- if eq $tpl "articles" -}}articles-page
    {{- else if eq $tpl "article" -}}article-page-body
    {{- else if eq $tpl "search" -}}search-page
    {{- else if eq $tpl "contact" -}}contact-page

    {{- else if eq $tpl "about-article" -}}about-article-page
    {{- else if eq $tpl "tags" -}}tags-page
    {{- else if eq $tpl "categories" -}}categories-page
    {{- else if eq $tpl "tag" -}}tag-page
    {{- else if eq $tpl "category" -}}category-page
    {{- else if eq $tpl "feed" -}}feed-page
    {{- else if eq $tpl "compose" -}}compose-page
    {{- else if eq $tpl "admin_home" -}}admin-dashboard-page
    {{- else if eq $tpl "404" -}}error-page
    {{- end -}}">
    <!-- Header -->
    <header class="site-header">
        <nav class="navbar">
            <div class="container">
                <div class="navbar-brand">
                    <a href="/" class="brand-link">
                        <h1 class="brand-title">{{ .config.Blog.Title }}</h1>
                        {{ if .config.Blog.Tagline }}<p class="brand-subtitle">{{ .config.Blog.Tagline }}</p>{{ end }}
                    </a>
                </div>

                <div class="navbar-menu" id="navbar-menu">
                    <ul class="navbar-nav">
                        <li class="nav-item">
                            <a href="/articles" class="nav-link">Writing</a>
                        </li>
                        <li class="nav-item">
                            <a href="/about" class="nav-link">About</a>
                        </li>
                        {{ if and (ne .config.Admin.Username "") (ne .config.Admin.Password "") }}
                        <li class="nav-item">
                            <a href="/compose" class="nav-link">Compose</a>
                        </li>
                        {{ end }}
                    </ul>
                </div>

                <div class="navbar-actions">
                    <a href="/search" class="nav-action-btn" aria-label="Search" title="Search">
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
                        </svg>
                        <span class="sr-only">Search</span>
                    </a>
                    <a href="/feed.xml" class="nav-action-btn" aria-label="RSS Feed" title="Subscribe via RSS">
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M3.429 2.776c7.729 0 10.367 2.714 10.367 10.368H11.07c0-5.585-1.909-7.494-7.494-7.494V2.776Z"/>
                            <path d="M3.429 6.205c4.373 0 6.938 2.565 6.938 6.938h-2.727c0-2.31-1.9-4.21-4.21-4.21V6.205Z"/>
                            <circle cx="4.571" cy="11.429" r="1.143"/>
                        </svg>
                        <span class="sr-only">RSS Feed</span>
                    </a>
                    <button class="theme-toggle" aria-label="Switch to dark mode" title="Toggle theme">
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"/>
                        </svg>
                    </button>
                    <button class="navbar-toggle" id="navbar-toggle" aria-label="Toggle navigation">
                        <span class="toggle-line"></span>
                        <span class="toggle-line"></span>
                        <span class="toggle-line"></span>
                    </button>
                </div>
            </div>
        </nav>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        {{ $tpl := .template | default "feed" }}
        {{ if eq $tpl "feed" }}{{ template "feed-content" . }}{{ end }}
        {{ if eq $tpl "compose" }}{{ template "compose-content" . }}{{ end }}
        {{ if eq $tpl "articles" }}{{ template "articles-content" . }}{{ end }}
        {{ if eq $tpl "article" }}{{ template "article-content" . }}{{ end }}
        {{ if eq $tpl "search" }}{{ template "search-content" . }}{{ end }}
        {{ if eq $tpl "contact" }}{{ template "contact-content" . }}{{ end }}

        {{ if eq $tpl "about-article" }}{{ template "about-article-content" . }}{{ end }}
        {{ if eq $tpl "tags" }}{{ template "tags-content" . }}{{ end }}
        {{ if eq $tpl "tag" }}{{ template "tag-content" . }}{{ end }}
        {{ if eq $tpl "categories" }}{{ template "categories-content" . }}{{ end }}
        {{ if eq $tpl "category" }}{{ template "category-content" . }}{{ end }}
        {{ if eq $tpl "admin_home" }}{{ template "admin_home-content" . }}{{ end }}
        {{ if eq $tpl "404" }}{{ template "404-content" . }}{{ end }}
    </main>

    <!-- Footer -->
    <footer class="site-footer">
        <div class="container">
            <nav class="footer-nav" aria-label="Footer navigation">
                <a href="/feed.xml" class="footer-link footer-subscribe">Subscribe</a>
                <a href="/tags" class="footer-link">Tags</a>
                <a href="/categories" class="footer-link">Categories</a>
                <a href="/contact" class="footer-link">Contact</a>
                <a href="/articles" class="footer-link">Writing</a>
            </nav>
            <p class="footer-colophon">
                &copy; {{ now.Year }} {{ .config.Blog.Author }} · Written in Markdown, published with <a href="https://github.com/vnykmshr/markgo" target="_blank" rel="noopener">MarkGo</a> · <span class="footer-version">{{ .app_version }}</span>
            </p>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="/static/js/main.js"></script>

    <!-- Template-specific JavaScript -->
    {{ $tpl := .template | default "feed" }}
    {{ if eq $tpl "404" }}<script src="/static/js/404.js"></script>{{ end }}
{{ if eq $tpl "about-article" }}<script src="/static/js/about-article.js"></script>{{ end }}
    {{ if eq $tpl "contact" }}<script src="/static/js/contact.js"></script>{{ end }}
    {{ if eq $tpl "search" }}<script src="/static/js/search.js"></script>{{ end }}

    <!-- Additional scripts -->
    {{ block "scripts" . }}{{ end }}

    <!-- Analytics (if needed) -->
    {{ if .config.Analytics }}
    <!-- Add your analytics code here -->
    {{ end }}
</body>
</html>
